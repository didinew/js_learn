# React 篇（大厂最爱追问）

① 为什么 useEffect 不能直接 async？

```js
useEffect(async () => {
await fetchData()
```

}, [])
❌ 为什么是错的？

useEffect 期望返回的是 cleanup 函数，而 async 函数返回 Promise

等价于：

```js
useEffect(() => {
return Promise.resolve()
```

})

## React：❌ 我不要 Promise

✅ 正确写法（标准答案）

```js
useEffect(() => {
const run = async () => {
await fetchData()
```

}
run()
}, [])
面试官想听的一句话

## useEffect 回调必须是同步函数，异步逻辑放在内部执行

② useEffect + await 会不会阻塞渲染？

结论（必背）

不会

## 原因

- 首次 render 一定先完成
- useEffect 在 commit 阶段后执行
- await 只暂停 effect 内部逻辑

---

③ useEffect 里为什么会“竞态问题”？（高级）

```js
useEffect(() => {
fetchData(id).then(setData)
```

}, [id])

## 问题

- id 快速变化
- 旧请求慢，新请求快
- 旧数据覆盖新数据

---

标准解决方案（面试加分）

```js
useEffect(() => {
let cancelled = false

fetchData(id).then(res => {
if (!cancelled) setData(res)
```

})

```js
return () => {
```

cancelled = true
}
}, [id])

或：

```js
AbortController;
```

---

④ useEffect 里 await 能写 forEach 吗？

❌ 不能

```js
useEffect(() => {
```

arr.forEach(async item => {

```js
await fn(item);
```

})
}, [])

## 正确写法

```js
useEffect(() => {
Promise.all(arr.map(item => fn(item)))
```

## }, [])

## Vue 3 篇（Composition API 必问）

⑤ setup 能不能是 async？

## 答案

能，但有代价

```js
export default {
```

async setup() {

```js
const data = await fetchData();
return { data };
```

}
}
代价是什么？

## 组件会被 Suspense 接管，渲染被延迟

面试官追问（必杀）

那为什么平时不推荐 async setup？

标准答案：

## 会延迟首屏渲染，不利于性能与 SEO，通常异步逻辑放在 onMounted。

⑥ watch / watchEffect 里用 await 的区别？

watch

```js
watch(id, async (newId) => {
await fetchData(newId)
```

})

- 支持 async

---

watchEffect（坑）

```js
watchEffect(async () => {
await fetchData(state.id)
```

})

❌ 问题

## 依赖收集在 await 前完成，await 后的响应式不会被追踪

## 面试标准说法

## watchEffect 不适合 async，应该用 watch

⑦ onMounted 里 await 会不会阻塞渲染？

## 结论

不会

## 组件已经 mount 完成。

⑧ Vue 中多个 await 是串行还是并行？

```js
onMounted(async () => {
await fetchA()
await fetchB()
```

})

## 结论

串行

并行写法同 JS 规则：

```js
const [a, b] = await Promise.all([fetchA(), fetchB()]);
```

---

## React vs Vue 对照必杀表（面试最爱）

| 场景           | React           | Vue                  |
| -------------- | --------------- | -------------------- |
| 生命周期 async | ❌ 不能         | ⚠️ setup 可          |
| 首次渲染阻塞   | ❌              | Suspense 会          |
| 推荐异步入口   | useEffect       | onMounted            |
| 依赖变化处理   | deps array      | watch                |
| 并发控制       | cleanup / Abort | watch + onInvalidate |

---

## 终极面试总结（背）

React 的 effect 必须是同步函数，async 会返回 Promise 导致错误；Vue 的 setup 可以 async，但会延迟渲染。watchEffect 不适合 async，异步竞态要通过 cleanup 或 AbortController 解决。
