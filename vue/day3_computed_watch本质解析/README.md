ğŸŸ¢ Day 3ï¼šcomputed vs watch æœ¬è´¨è§£æ

â¸»

ä¸€ã€å…ˆç»™æœ€ç»ˆç»“è®ºï¼ˆç›´æ¥èƒŒï¼‰

computed æ˜¯â€œæœ‰ç¼“å­˜çš„æ´¾ç”ŸçŠ¶æ€â€
watch æ˜¯â€œå“åº”å¼æ•°æ®å˜åŒ–åçš„å‰¯ä½œç”¨â€

è¿™å¥è¯ = ä»Šå¤© 80% å†…å®¹

â¸»

äºŒã€computed çš„æœ¬è´¨ï¼ˆä¸æ˜¯å‡½æ•°ï¼‰

const total = computed(() => price.value * count.value)
computed â‰  function

computed æœ¬è´¨æ˜¯ï¼š

å¸¦ç¼“å­˜çš„ effect + getter

â¸»

computed çš„æ ¸å¿ƒç‰¹æ€§
ç‰¹æ€§
è¯´æ˜
æ‡’æ‰§è¡Œ
ä¸ç”¨ä¸ç®—
æœ‰ç¼“å­˜
ä¾èµ–ä¸å˜ä¸é‡æ–°æ‰§è¡Œ
åªè¯»
é»˜è®¤ä¸èƒ½ set
çº¯å‡½æ•°
ä¸è¯¥æœ‰å‰¯ä½œç”¨

ğŸ“Œ computed æ°¸è¿œä¸åº”è¯¥å‘è¯·æ±‚

â¸»

computed å†…éƒ¨é€»è¾‘ï¼ˆä½ è¦ä¼šè®²ï¼‰
let dirty = true
let value

effect(() => {
  value = getter()
}, {
  lazy: true,
  scheduler() {
    dirty = true
  }
})

	â€¢	ä¾èµ–å˜ â†’ æ ‡è®° dirty
	â€¢	ä¸‹æ¬¡ .value â†’ é‡æ–°è®¡ç®—

â¸»

ä¸‰ã€watch çš„æœ¬è´¨ï¼ˆå‰¯ä½œç”¨å·¥å…·ï¼‰

watch(source, (newVal, oldVal) => {})

ğŸ“Œ å¸¸è§å‰¯ä½œç”¨ï¼š
	â€¢	å‘è¯·æ±‚
	â€¢	æ“ä½œ DOM
	â€¢	æ‰“æ—¥å¿—
	â€¢	åŒæ­¥ localStorage

â¸»

watch çš„ä¸‰ä¸ªå…³é”®ç‚¹ï¼ˆå¿…é¡»ä¼šï¼‰

1ï¸âƒ£ source æ˜¯ä»€ä¹ˆï¼Ÿ
	â€¢	ref
	â€¢	reactiveï¼ˆæ·±åº¦ï¼‰
	â€¢	getter å‡½æ•°

2ï¸âƒ£ ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼Ÿ
	â€¢	ä¾èµ–å˜åŒ–
	â€¢	å¯ immediate

3ï¸âƒ£ å‰¯ä½œç”¨æ¸…ç†
watch(source, (n, o, onCleanup) => {
  onCleanup(() => cancel())
})


â¸»

å››ã€watchEffect æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆå¾ˆå¤šäººä¹±ç”¨ï¼‰
watchEffect(() => {
  console.log(state.count)
})
æœ¬è´¨ï¼š

è‡ªåŠ¨æ”¶é›†ä¾èµ–çš„ watch

ğŸ“Œ åŒºåˆ«ï¼š
watch
watchEffect
æ˜ç¡®ä¾èµ–
è‡ªåŠ¨æ”¶é›†
å¯æ‹¿ oldValue
âŒ
æ‡’æ‰§è¡Œ
ç«‹å³æ‰§è¡Œ

âš ï¸ å¤æ‚é€»è¾‘ä¸æ¨è watchEffect

â¸»

äº”ã€ä¸ºä»€ä¹ˆ computed ä¸èƒ½æ›¿ä»£ watchï¼Ÿ

âŒ é”™è¯¯ç”¨æ³•ï¼ˆé¢è¯•å¸¸è§ï¼‰
const data = computed(() => {
  fetchData()  // âŒ
})

ğŸ’£ åŸå› ï¼š
	â€¢	computed å¯èƒ½è¢«ç¼“å­˜
	â€¢	å‰¯ä½œç”¨ä¸å¯æ§
	â€¢	æ—¶åºæ··ä¹±

â¸»

å…­ã€ä¸€ä¸ªé«˜é¢‘â€œæ·±æ°´åŒºâ€é—®é¢˜
watch(
  () => state.user,
  () => {},
  { deep: true }
)
â“ ä¸ºä»€ä¹ˆ deep watch æ€§èƒ½å·®ï¼Ÿ

âœ… æ­£è§£ï¼š

deep watch ä¼šé€’å½’éå†å¯¹è±¡ï¼Œç»™æ¯ä¸ªå±æ€§å»ºç«‹ä¾èµ–ï¼Œä»»ä½•æ·±å±‚å˜åŒ–éƒ½ä¼šè§¦å‘å›è°ƒï¼Œæˆæœ¬é«˜ã€‚

ğŸ“Œ ä¼˜åŒ–æ–¹å¼ï¼š
watch(() => state.user.id, ...)

â¸»

ä¸ƒã€computed / watch é€‰æ‹©é€ŸæŸ¥è¡¨ï¼ˆå¿…èƒŒï¼‰

åœºæ™¯
ç”¨ä»€ä¹ˆ
æ´¾ç”Ÿæ•°æ®
computed
å‘è¯·æ±‚
watch
è¡¨å•è”åŠ¨
watch
ç®€å•è‡ªåŠ¨è¿½è¸ª
watchEffect
æ€§èƒ½æ•æ„Ÿ
computed


â¸»

å…«ã€Day 3 é¢è¯•æ ‡å‡†ç­”æ¡ˆ

computed å’Œ watch æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

âœ… æ»¡åˆ†å›ç­”ï¼š

computed ç”¨äºæè¿°ç”±å“åº”å¼æ•°æ®æ´¾ç”Ÿå‡ºçš„çŠ¶æ€ï¼Œæœ¬è´¨æ˜¯å¸¦ç¼“å­˜çš„ effectï¼Œåªæœ‰ä¾èµ–å˜åŒ–æ—¶æ‰é‡æ–°è®¡ç®—ï¼›watch ç”¨äºç›‘å¬æ•°æ®å˜åŒ–å¹¶æ‰§è¡Œå‰¯ä½œç”¨ï¼Œæ²¡æœ‰ç¼“å­˜ï¼Œæ›´é€‚åˆå¤„ç†å¼‚æ­¥ã€DOM æ“ä½œç­‰åœºæ™¯ã€‚

â¸»

ä¹ã€ä»Šæ—¥å¿…åšä»»åŠ¡ï¼ˆçœŸå®é¢è¯•é¢˜ï¼‰

âœï¸ åˆ¤æ–­ä¸‹é¢ä»£ç æ‰§è¡Œæ¬¡æ•°
const count = ref(0)

const double = computed(() => {
  console.log('computed')
  return count.value * 2
})

watch(count, () => {
  console.log('watch')
})

count.value++
count.value++
âœ… æ­£ç¡®ç­”æ¡ˆï¼š
	â€¢	computed æ‰“å° 1 æ¬¡ï¼ˆæˆ– 2 æ¬¡ï¼Œå–å†³äºæ˜¯å¦è®¿é—® .valueï¼‰
	â€¢	watch æ‰“å° 2 æ¬¡

ğŸ“Œ å¦‚æœä½ æ²¡è®¿é—® double.valueï¼Œcomputed æ ¹æœ¬ä¸ä¼šæ‰§è¡Œã€‚

