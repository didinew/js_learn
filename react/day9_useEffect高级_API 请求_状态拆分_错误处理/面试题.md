
â¸»

1ï¸âƒ£ useEffect çš„ä¾èµ–æ•°ç»„æ€ä¹ˆç”¨ï¼Ÿç©ºæ•°ç»„å’Œæœ‰ä¾èµ–æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

useEffect çš„è¯­æ³•ï¼š

useEffect(() => {
  // å‰¯ä½œç”¨é€»è¾‘
  return () => {
    // æ¸…ç†é€»è¾‘
  }
}, [ä¾èµ–æ•°ç»„]);


	â€¢	ä¾èµ–æ•°ç»„ä½œç”¨ï¼šå‘Šè¯‰ React å“ªäº›å˜é‡çš„å˜åŒ–ä¼šè§¦å‘è¿™ä¸ª effect é‡æ–°æ‰§è¡Œã€‚
	â€¢	æƒ…å†µ 1ï¼šç©ºæ•°ç»„ []

	useEffect(() => {
  console.log("åªåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡");
}, []);

âœ… æ•ˆæœï¼šåªåœ¨ç»„ä»¶ æŒ‚è½½ æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œå¸è½½æ—¶æ‰§è¡Œæ¸…ç†å‡½æ•°ã€‚ç±»ä¼¼ componentDidMount + componentWillUnmountã€‚

	â€¢	æƒ…å†µ 2ï¼šä¾èµ–å˜é‡ [a, b]
	useEffect(() => {
  console.log("a æˆ– b æ”¹å˜æ—¶æ‰æ‰§è¡Œ");
}, [a, b]);
âœ… æ•ˆæœï¼šåªæœ‰ä¾èµ–æ•°ç»„é‡Œçš„å˜é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œeffect æ‰é‡æ–°æ‰§è¡Œï¼Œé¿å…æ¯æ¬¡æ¸²æŸ“éƒ½è¿è¡Œã€‚

	â€¢	æƒ…å†µ 3ï¼šæ²¡æœ‰ä¾èµ–æ•°ç»„

	useEffect(() => {
  console.log("æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ‰§è¡Œ");
});

âš ï¸ æ³¨æ„ï¼šæ¯æ¬¡ç»„ä»¶æ¸²æŸ“éƒ½ä¼šæ‰§è¡Œ effectï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜æˆ–é‡å¤è¯·æ±‚ã€‚

ğŸ’¡ æé†’
	â€¢	ä¾èµ–å¿…é¡»å®Œæ•´åˆ—å‡ºï¼Œå¦åˆ™å¯èƒ½ä½¿ç”¨çš„æ˜¯æ—§å€¼ï¼ˆé—­åŒ…é™·é˜±ï¼‰ã€‚
	â€¢	å¯¹è±¡/æ•°ç»„/å‡½æ•°ä½œä¸ºä¾èµ–æ—¶ï¼Œéœ€è¦ä¿è¯å¼•ç”¨ç¨³å®šï¼Œå¦åˆ™ effect ä¼šé¢‘ç¹è§¦å‘ï¼Œå¯ç”¨ useMemo / useCallbackã€‚

â¸»

2ï¸âƒ£ å¦‚ä½•é˜²æ­¢ç»„ä»¶å¸è½½å setState æŠ¥é”™ï¼Ÿ

å½“å¼‚æ­¥æ“ä½œï¼ˆfetch / setTimeout / Promiseï¼‰å®Œæˆæ—¶ï¼Œå¦‚æœç»„ä»¶å·²ç»å¸è½½ï¼Œè°ƒç”¨ setState ä¼šæŠ¥è­¦å‘Šã€‚

å¸¸ç”¨åšæ³•ï¼š

useEffect(() => {
  let mounted = true;

  fetchData().then(data => {
    if (mounted) setData(data);
  });

  return () => {
    mounted = false; // å¸è½½æ—¶æ ‡è®°
  }
}, []);

âœ… åŸç†ï¼šé€šè¿‡æ ‡è®°å˜é‡åˆ¤æ–­ç»„ä»¶æ˜¯å¦ä»ç„¶æŒ‚è½½ï¼Œå†æ›´æ–° stateã€‚

è¿›é˜¶åšæ³•ï¼šAbortController + fetch
	â€¢	å¯¹äº fetch è¯·æ±‚ï¼Œå¯ä»¥ç›´æ¥å–æ¶ˆè¯·æ±‚ï¼Œé¿å… Promise resolve åå† setStateã€‚

â¸»

3ï¸âƒ£ Smart / Dumb ç»„ä»¶èŒè´£åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

ç±»å‹
ä¸»è¦èŒè´£
ç‰¹ç‚¹
Smart (Container/Stateful)
ç®¡ç†æ•°æ®ã€çŠ¶æ€ã€ä¸šåŠ¡é€»è¾‘ã€API è¯·æ±‚
æœ‰ state / useEffect / å¤„ç†äº‹ä»¶ï¼Œå°‘é‡ UI é€»è¾‘
Dumb (Presentational)
åªè´Ÿè´£ UI å±•ç¤º
é€šè¿‡ props æ¥æ”¶æ•°æ®å’Œäº‹ä»¶å›è°ƒï¼Œæ— è‡ªèº«çŠ¶æ€ï¼ˆæˆ–åªç®¡ç† UI çŠ¶æ€ï¼‰

ç¤ºä¾‹ï¼š

// Dumb
const Button = ({ label, onClick }) => <button onClick={onClick}>{label}</button>;

// Smart
const Counter = () => {
  const [count, setCount] = useState(0);
  return <Button label={count} onClick={() => setCount(c => c + 1)} />;
};
ğŸ’¡ ä¼˜åŠ¿ï¼š
	â€¢	å¯å¤ç”¨ UI ç»„ä»¶ï¼ˆDumbï¼‰
	â€¢	Smart ç»„ä»¶åªç®¡é€»è¾‘ï¼Œæ˜“äºæµ‹è¯•å’Œç»´æŠ¤

â¸»

4ï¸âƒ£ å¼‚æ­¥è¯·æ±‚çŠ¶æ€å¦‚ä½•æ‹†åˆ†ï¼Ÿ

å¼‚æ­¥çŠ¶æ€é€šå¸¸æ‹†æˆ 3 ä¸ªç»´åº¦ï¼š
	1.	æ•°æ®çŠ¶æ€ï¼ˆdataï¼‰
	2.	åŠ è½½çŠ¶æ€ï¼ˆloadingï¼‰
	3.	é”™è¯¯çŠ¶æ€ï¼ˆerrorï¼‰

	const [data, setData] = useState(null);
const [loading, setLoading] = useState(false);
const [error, setError] = useState(null);

useEffect(() => {
  setLoading(true);
  fetchData()
    .then(res => setData(res))
    .catch(err => setError(err))
    .finally(() => setLoading(false));
}, []);

æ‹†åˆ†å¥½å¤„ï¼š
	â€¢	UI å¯ä»¥æ ¹æ®çŠ¶æ€åˆ†åˆ«æ¸²æŸ“ï¼šSkeletonã€Error Messageã€å†…å®¹
	â€¢	é¿å…çŠ¶æ€æ··ä¹±æˆ–è¦†ç›–

å¯å‡çº§å†™æ³•ï¼š
	â€¢	å°è£…æˆ è‡ªå®šä¹‰ Hookï¼š

	function useFetch(url) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  useEffect(() => {
    let mounted = true;
    setLoading(true);
    fetch(url)
      .then(res => res.json())
      .then(d => mounted && setData(d))
      .catch(e => mounted && setError(e))
      .finally(() => mounted && setLoading(false));
  }, [url]);

  return { data, loading, error };
}

è¿™æ · Smart ç»„ä»¶åªç®¡é€»è¾‘ï¼ŒDumb ç»„ä»¶åªç®¡ UIã€‚