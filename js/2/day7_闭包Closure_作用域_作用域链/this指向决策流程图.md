🧭 JS this 指向【决策流程图】

┌────────────────────────────┐
│ 1️⃣ 是箭头函数吗？          │
└───────────────┬────────────┘
| │ 是 | ▼ |
| --- | --- |
| this = 定义时的外层 this | （call / apply / bind 无效） |
| │ | └──────────▶ 结束 |
| 否 | ▼ |
┌────────────────────────────┐
│ 2️⃣ 是用 new 调用的吗？     │
└───────────────┬────────────┘
                │ 是
| ▼ | this = 新创建的实例对象 |
| --- | --- |
| │ | └──────────▶ 结束 |
| 否 | ▼ |
┌────────────────────────────┐
│ 3️⃣ 用 call / apply / bind？│
└───────────────┬────────────┘
                │ 是
| ▼ | this = 显式绑定的对象 |
| --- | --- |
| │ | └──────────▶ 结束 |
| 否 | ▼ |
┌────────────────────────────┐
│ 4️⃣ 是否由对象调用？        │
│   obj.fn()                  │
└───────────────┬────────────┘
                │ 是
| ▼ | this = 调用该方法的对象 | │ | └──────────▶ 结束 |
| --- | --- | --- | --- |
| 否 | ▼ | ┌────────────────────────────┐ | │ 5️⃣ 默认绑定（独立调用）    │ |
| └───────────────┬────────────┘ | │ | 非严格模式 → window | 严格模式   → undefined |
                │
                └──────────▶ 结束

              
🧠 一眼秒判口诀（必须背）

箭头看外层，new 看实例，
bind/call/apply 看第一个参数，
对象看点左边，
剩下就是 window / undefined
---
🔥 用流程图秒杀 3 道题

题 1

```js
const obj = {
```
  name: 'A',
  foo() {
    setTimeout(function () {
```js
      console.log(this.name)
```
    })
  }
}
obj.foo()

✔️ 判断路径：
- 普通函数 ❌
- new ❌
- bind ❌
- 对象调用 ❌（setTimeout 中）
- 默认绑定 ✅
- 输出：undefined
---
题 2

```js
const obj = {
```
  name: 'A',
  foo() {
    setTimeout(() => {
```js
      console.log(this.name)
```
    })
  }
}
obj.foo()

✔️ 判断路径：
- 箭头函数 ✅ → 继承 foo 的 this
- 输出：A
---
题 3

```js
function Foo() {
```
  this.a = 1
}
```js
const bar = Foo.bind({ a: 2 })
const obj = new bar()
console.log(obj.a)

```
✔️ 判断路径：
- 箭头 ❌
- new ✅（优先级最高）
- 输出：1
---
🚀 面试官最爱追问（加分）

Q：为什么 this 不在编译期确定？

因为 JS 函数是一等公民，
同一个函数可以被不同对象以不同方式调用，
this 必须在运行时动态绑定。
