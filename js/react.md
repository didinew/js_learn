ğŸš€ React é¢è¯•å¿…æ€é€Ÿè§ˆï¼ˆé«˜é¢‘ï¼‰

1ï¸âƒ£ React æ˜¯ä»€ä¹ˆï¼Ÿæ ¸å¿ƒæ€æƒ³ï¼Ÿ

UI = f(state)
	â€¢	ç»„ä»¶åŒ–
	â€¢	å•å‘æ•°æ®æµ
	â€¢	å£°æ˜å¼ UI
	â€¢	çŠ¶æ€é©±åŠ¨è§†å›¾

ğŸ‘‰ é¢è¯•å®˜è¿½é—®ï¼š
ä¸ºä»€ä¹ˆå£°æ˜å¼æ¯”å‘½ä»¤å¼å¥½ï¼Ÿ

æ›´æ˜“ç»´æŠ¤ã€çŠ¶æ€å¯é¢„æµ‹ã€å‡å°‘å‰¯ä½œç”¨

â¸»

2ï¸âƒ£ Virtual DOM æ˜¯ä»€ä¹ˆï¼Ÿä¸€å®šæ›´å¿«å—ï¼Ÿ
	â€¢	JS å¯¹è±¡æè¿°çœŸå® DOM
	â€¢	Diff ç®—æ³•å‡å°‘ DOM æ“ä½œ
	â€¢	ä¸æ˜¯ä¸€å®šæ›´å¿«ï¼Œè€Œæ˜¯æ€§èƒ½æ›´ç¨³å®šã€å¯æ§

ğŸ‘‰ è¿½é—®ï¼š
ä¸ºä»€ä¹ˆ key ä¸èƒ½ç”¨ indexï¼Ÿ

ä¼šå¯¼è‡´èŠ‚ç‚¹å¤ç”¨é”™è¯¯ï¼Œå¼•å‘çŠ¶æ€é”™ä¹±

â¸»

3ï¸âƒ£ React ç»„ä»¶é€šä¿¡æ–¹å¼
	â€¢	props
	â€¢	callback
	â€¢	Context
	â€¢	Redux / Zustand
	â€¢	URL / localStorage

ğŸ‘‰ è¿½é—®ï¼š
ä»€ä¹ˆæ—¶å€™ç”¨ Contextï¼Œä»€ä¹ˆæ—¶å€™ç”¨ Reduxï¼Ÿ

Context é€‚åˆä½é¢‘ã€ç¨³å®šæ•°æ®ï¼ˆä¸»é¢˜/è¯­è¨€ï¼‰ï¼ŒRedux ç®¡ç†å¤æ‚çŠ¶æ€æµ

â¸»

4ï¸âƒ£ Hooks å‡ºç°è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
	â€¢	ç±»ç»„ä»¶é€»è¾‘å¤ç”¨å›°éš¾
	â€¢	this æŒ‡å‘å¤æ‚
	â€¢	ç”Ÿå‘½å‘¨æœŸåˆ†æ•£

ğŸ‘‰ æ ¸å¿ƒ Hooksï¼š
	â€¢	useState
	â€¢	useEffect
	â€¢	useMemo
	â€¢	useCallback
	â€¢	useRef

â¸»

5ï¸âƒ£ useEffect æ‰§è¡Œæ—¶æœºï¼Ÿ

é¦–æ¬¡æ¸²æŸ“å
ä¾èµ–å˜åŒ–å

ğŸ‘‰ è¿½é—®å¿…æŒ‚ç‚¹ï¼š
useEffect å’Œ useLayoutEffect åŒºåˆ«ï¼Ÿ
	â€¢	useEffectï¼šå¼‚æ­¥ï¼Œä¸é˜»å¡æ¸²æŸ“
	â€¢	useLayoutEffectï¼šåŒæ­¥ï¼ŒDOM æ›´æ–°åç«‹å³æ‰§è¡Œï¼ˆå¯èƒ½å¡é¡¿ï¼‰

â¸»

6ï¸âƒ£ React æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µ
	â€¢	React.memo
	â€¢	useMemo / useCallback
	â€¢	åˆç† key
	â€¢	çŠ¶æ€ä¸‹æ²‰ / æ‹†åˆ†ç»„ä»¶
	â€¢	è™šæ‹Ÿåˆ—è¡¨

ğŸ‘‰ è¿½é—®ï¼š
useCallback ä¸€å®šæœ‰æ€§èƒ½æ”¶ç›Šå—ï¼Ÿ

ä¸ä¸€å®šï¼Œæ»¥ç”¨ä¼šå¢åŠ å†…å­˜å’Œå¤æ‚åº¦

â¸»

7ï¸âƒ£ React 18 æ–°ç‰¹æ€§ï¼ˆå¿…é—®ï¼‰
	â€¢	Concurrent Rendering
	â€¢	è‡ªåŠ¨æ‰¹å¤„ç†ï¼ˆsetStateï¼‰
	â€¢	useTransition
	â€¢	useDeferredValue

ğŸ‘‰ è¿½é—®ï¼š
å¹¶å‘æ¸²æŸ“è§£å†³äº†ä»€ä¹ˆï¼Ÿ

å¡é¡¿ã€é•¿ä»»åŠ¡é˜»å¡ UI

â¸»

8ï¸âƒ£ setState æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ
	â€¢	React äº‹ä»¶ä¸­æ˜¯å¼‚æ­¥
	â€¢	åŸç”Ÿäº‹ä»¶ / setTimeout ä¸­æ˜¯åŒæ­¥
	â€¢	React 18ï¼šå‡ ä¹å…¨éƒ¨è‡ªåŠ¨æ‰¹å¤„ç†

â¸»

9ï¸âƒ£ Redux å·¥ä½œæµç¨‹
View â†’ dispatch(action)
â†’ reducer
â†’ store
â†’ View æ›´æ–°

ğŸ‘‰ è¿½é—®ï¼š
Redux ä¸ºä»€ä¹ˆæ˜¯çº¯å‡½æ•°ï¼Ÿ

å¯é¢„æµ‹ã€å¯å›æ”¾ã€æ˜“æµ‹è¯•

â¸»

ğŸ”Ÿ React vs Vueï¼ˆä¸€å¥è¯ï¼‰
å¯¹æ¯”
React
Vue
æ€æƒ³
å‡½æ•°å¼
æ¨¡æ¿ + å“åº”å¼
JSX
å¼ºä¾èµ–
å¯é€‰
ä¸Šæ‰‹
åé™¡
åå¿«
çµæ´»åº¦
æé«˜
æ›´è§„èŒƒ

ğŸ¤ React æ¨¡æ‹Ÿé¢è¯•ï¼ˆç¬¬ 1 é¢˜ï½œå¿…æŒ‚é¢˜ï¼‰

â“ Q1

React ä¸­ï¼Œä¸ºä»€ä¹ˆå‡½æ•°ç»„ä»¶æ¯æ¬¡ render éƒ½ä¼šé‡æ–°æ‰§è¡Œï¼Ÿè¿™ä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼ŸReact æ˜¯å¦‚ä½•è§£å†³çš„ï¼Ÿ

React ä¸­å‡½æ•°ç»„ä»¶æ¯æ¬¡ render éƒ½ä¼šé‡æ–°æ‰§è¡Œï¼Œæ˜¯å› ä¸ºç»„ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼ŒReact é€šè¿‡é‡æ–°è°ƒç”¨å‡½æ•°æ¥æ ¹æ®æœ€æ–°çš„ state å’Œ props è®¡ç®— UI æè¿°ï¼Œè¿™æ˜¯å‡½æ•°å¼ã€å£°æ˜å¼è®¾è®¡çš„å¿…ç„¶ç»“æœã€‚

è¿™æ ·åšçš„å¥½å¤„æ˜¯ UI = f(state)ï¼Œä¿è¯ç»“æœå¯é¢„æµ‹ï¼Œä½†é—®é¢˜æ˜¯å¦‚æœåœ¨ render è¿‡ç¨‹ä¸­å­˜åœ¨æ˜‚è´µè®¡ç®—æˆ–ä¸å¿…è¦çš„å­ç»„ä»¶æ›´æ–°ï¼Œå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚

React é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥è§£å†³ï¼š
	1.	useMemoï¼šç¼“å­˜è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—
	2.	useCallbackï¼šç¨³å®šå‡½æ•°å¼•ç”¨ï¼Œé¿å…å­ç»„ä»¶ä¸å¿…è¦ render
	3.	React.memoï¼šé˜»æ­¢ props æœªå˜åŒ–çš„å­ç»„ä»¶é‡æ–° render
	4.	çŠ¶æ€æ‹†åˆ† / ä¸‹æ²‰ï¼šå‡å°‘ render å½±å“èŒƒå›´

â¸»

ğŸ¯ é¢è¯•å®˜åŠ è¿½é—®ï¼ˆä¸‹ä¸€é¢˜ï¼‰

â“ Q1-è¿½é—®

é‚£æ—¢ç„¶å‡½æ•°ç»„ä»¶æ¯æ¬¡éƒ½ä¼šé‡æ–°æ‰§è¡Œï¼Œä¸ºä»€ä¹ˆ useState çš„å€¼ä¸ä¼šä¸¢å¤±ï¼Ÿå®ƒæ˜¯æ€ä¹ˆä¿å­˜çŠ¶æ€çš„ï¼Ÿ

è™½ç„¶å‡½æ•°ç»„ä»¶æ¯æ¬¡ render éƒ½ä¼šé‡æ–°æ‰§è¡Œï¼Œä½† React å¹¶ä¸æ˜¯æŠŠ state å­˜åœ¨å‡½æ•°é‡Œï¼Œè€Œæ˜¯æŠŠ state å­˜åœ¨ç»„ä»¶å¯¹åº”çš„ Fiber èŠ‚ç‚¹ä¸Šã€‚

useState æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ Hooks é“¾è¡¨ï¼ŒæŒ‰ç…§è°ƒç”¨é¡ºåºï¼ŒæŠŠ state æŒ‚è½½åœ¨å½“å‰ Fiber ä¸Šã€‚æ¯æ¬¡ç»„ä»¶é‡æ–°æ‰§è¡Œæ—¶ï¼ŒReact ä¼šæ ¹æ® Hooks çš„é¡ºåºï¼Œä» Fiber ä¸Šå–å‡ºå¯¹åº”çš„ stateï¼Œè€Œä¸æ˜¯é‡æ–°åˆå§‹åŒ–ã€‚

å› æ­¤ï¼Œåªè¦ Hooks çš„è°ƒç”¨é¡ºåºä¸å˜ï¼Œstate å°±å¯ä»¥åœ¨å¤šæ¬¡ render ä¹‹é—´ä¿æŒç¨³å®šï¼Œä¸ä¼šä¸¢
å‡½æ•°ç»„ä»¶é‡æ–°æ‰§è¡Œçš„æ˜¯â€œè®¡ç®—è¿‡ç¨‹â€ï¼Œè€Œ state æ˜¯å­˜å‚¨åœ¨ React å†…éƒ¨ Fiber ç»“æ„ä¸­çš„ï¼Œä¸å±äºå‡½æ•°æœ¬èº«ã€‚

â“ è¿½é—® 1ï¼šé‚£ Hooks ä¸ºä»€ä¹ˆä¸èƒ½å†™åœ¨æ¡ä»¶é‡Œï¼Ÿ

å› ä¸º React æ˜¯æŒ‰è°ƒç”¨é¡ºåºæ¥åŒ¹é… Fiber ä¸Šçš„ Hookï¼Œå¦‚æœé¡ºåºå˜åŒ–ï¼Œå°±ä¼šè¯»é”™ stateï¼Œå¯¼è‡´çŠ¶æ€é”™ä¹±ã€‚

â¸»

â“ è¿½é—® 2ï¼šé‚£ useState çš„åˆå§‹å€¼ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿ

åªåœ¨é¦–æ¬¡ mount æ—¶æ‰§è¡Œï¼Œåç»­ render ä¼šç›´æ¥è¯»å– Fiber ä¸Šç¼“å­˜çš„ stateã€‚

â¸»

â“ è¿½é—® 3ï¼šå¤šä¸ª useState æ˜¯æ€ä¹ˆåŒºåˆ†çš„ï¼Ÿ

é€šè¿‡ Hooks é“¾è¡¨çš„é¡ºåºä½ç½®ï¼Œè€Œä¸æ˜¯å˜é‡åã€‚

â¸»

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç»§ç»­ Q2ï¼š
ğŸ‘‰ useEffect çš„ä¾èµ–æ•°ç»„æ˜¯æ€ä¹ˆæ¯”è¾ƒçš„ï¼Ÿä¸ºä»€ä¹ˆæ˜¯æµ…æ¯”è¾ƒï¼Ÿ
useEffect çš„ä¾èµ–æ•°ç»„æ˜¯é€šè¿‡ Object.is è¿›è¡Œé€é¡¹æµ…æ¯”è¾ƒçš„ã€‚

æ¯æ¬¡ render åï¼ŒReact ä¼šæ‹¿æœ¬æ¬¡ä¾èµ–å’Œä¸Šä¸€æ¬¡ä¾èµ–é€ä¸ªå¯¹æ¯”ï¼Œåªè¦æœ‰ä»»æ„ä¸€é¡¹å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šé‡æ–°æ‰§è¡Œ effectã€‚

â¸»

ğŸ§  ä¸ºä»€ä¹ˆæ˜¯æµ…æ¯”è¾ƒï¼Ÿï¼ˆè¿™æ˜¯å…³é”®ï¼‰

å› ä¸ºæ·±æ¯”è¾ƒæˆæœ¬é«˜ã€ä¸ç¡®å®šæ€§å¼ºï¼Œè€Œä¸”å®¹æ˜“å¼•å…¥æ€§èƒ½é—®é¢˜å’Œä¸å¯æ§è¡Œä¸ºã€‚

React çš„è®¾è®¡ç†å¿µæ˜¯ï¼š
ğŸ‘‰ ç”±å¼€å‘è€…æ¥ä¿è¯ä¾èµ–çš„ç¨³å®šæ€§ï¼Œè€Œä¸æ˜¯æ¡†æ¶å·å·å¸®ä½ åšæ·±æ¯”è¾ƒã€‚

â¸»

ğŸ¯ é¢è¯•å®˜åŠ åˆ†è¡¥å……ï¼ˆä¸€å®šè¦è¯´ï¼‰

å¦‚æœä¾èµ–æ˜¯å¯¹è±¡æˆ–å‡½æ•°ï¼Œç”±äºæ¯æ¬¡ render éƒ½ä¼šäº§ç”Ÿæ–°å¼•ç”¨ï¼Œå³ä½¿å†…å®¹æ²¡å˜ï¼Œä¹Ÿä¼šè§¦å‘ effectã€‚

å› æ­¤éœ€è¦é…åˆ useMemo / useCallback æ¥ç¨³å®šå¼•ç”¨ã€‚

â¸»

â“ é¢è¯•å®˜å¸¸è§è¿½é—®ï¼ˆç›´æ¥ç§’ï¼‰

è¿½é—® 1ï¼šé‚£ä¸ºä»€ä¹ˆä¸ç”¨ JSON.stringify æ¥æ¯”ï¼Ÿ

ä¸å¯é ï¼ˆé¡ºåºé—®é¢˜ / å¾ªç¯å¼•ç”¨ï¼‰ï¼Œæ€§èƒ½å·®ï¼Œä¸é€‚åˆæ¡†æ¶å±‚ä½¿ç”¨ã€‚

â¸»

è¿½é—® 2ï¼šä¾èµ–æ•°ç»„ä¸å†™ä¼šæ€æ ·ï¼Ÿ

æ¯æ¬¡ render åéƒ½ä¼šæ‰§è¡Œï¼Œç›¸å½“äº componentDidUpdate + componentDidMountã€‚

â¸»

è¿½é—® 3ï¼šä¾èµ–æ•°ç»„å†™ç©º [] å‘¢ï¼Ÿ

åªåœ¨é¦–æ¬¡ mount æ—¶æ‰§è¡Œä¸€æ¬¡ï¼ˆä¸¥æ ¼æ¨¡å¼ä¸‹å¼€å‘ç¯å¢ƒå¯èƒ½æ‰§è¡Œä¸¤æ¬¡ï¼‰ã€‚

â¸»

è¿½é—® 4ï¼šé‚£ ESLint ä¸ºä»€ä¹ˆè€æ˜¯æç¤ºä½ è¡¥ä¾èµ–ï¼Ÿ

ä¸ºäº†é¿å…é—­åŒ…æ•è·æ—§å€¼ï¼Œä¿è¯ effect ä½¿ç”¨çš„æ˜¯æœ€æ–°çŠ¶æ€ã€‚

â¸»

ğŸ§  ä¸€å¥è¯ç»ˆææ€»ç»“ï¼ˆé¢è¯•å®˜æœ€çˆ±ï¼‰

useEffect ä¾èµ–é‡‡ç”¨æµ…æ¯”è¾ƒï¼Œæ˜¯ React åœ¨æ€§èƒ½ã€å¯é¢„æµ‹æ€§å’Œå¼€å‘è€…æ§åˆ¶æƒä¹‹é—´çš„æƒè¡¡ç»“æœã€‚

â¸»

è¦ä¸è¦æˆ‘ç»§ç»­ Q3ï¼š
ğŸ‘‰ useEffect çš„é—­åŒ…é™·é˜±æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•å½»åº•è§£å†³ï¼Ÿ

useEffect çš„é—­åŒ…é™·é˜±æŒ‡çš„æ˜¯ï¼šåœ¨ effect ä¸­ä½¿ç”¨çš„ state æˆ– propsï¼Œå¹¶ä¸æ˜¯æœ€æ–°çš„å€¼ï¼Œè€Œæ˜¯ effect åˆ›å»ºæ—¶æ‰€æ•è·çš„é‚£ä¸€æ¬¡ render çš„å€¼ã€‚

è¿™æ˜¯å› ä¸º JavaScript çš„é—­åŒ…ç‰¹æ€§ï¼šuseEffect å›è°ƒåœ¨å®šä¹‰æ—¶ï¼Œå°±å·²ç»ç»‘å®šäº†å½“æ¬¡ render çš„å˜é‡ç¯å¢ƒï¼Œåç»­ state æ›´æ–°å¹¶ä¸ä¼šè‡ªåŠ¨æ›´æ–°è¿™ä¸ªé—­åŒ…ä¸­çš„å€¼ã€‚

â¸»

ğŸ§  ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿï¼ˆä¸€å®šè¦è®²æ¸…ï¼‰

å‡½æ•°ç»„ä»¶æ¯æ¬¡ render éƒ½ä¼šç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„ä½œç”¨åŸŸï¼Œè€Œ useEffect ä½¿ç”¨çš„æ˜¯æŸä¸€æ¬¡ render ç”Ÿæˆçš„é—­åŒ…ã€‚

å¦‚æœä¾èµ–æ•°ç»„æ²¡æœ‰åŒ…å«å¯¹åº”çš„å˜é‡ï¼ŒReact ä¸ä¼šé‡æ–°åˆ›å»º effectï¼Œé—­åŒ…è‡ªç„¶å°±ä¸€ç›´æ˜¯æ—§çš„ã€‚

â¸»

â“ é¢è¯•å®˜è¿½é—® 1

é‚£æ€ä¹ˆè§£å†³é—­åŒ…é™·é˜±ï¼Ÿ

âœ… è§£æ³• 1ï¼ˆæœ€æ¨èï¼‰

æ­£ç¡®å¡«å†™ä¾èµ–æ•°ç»„ï¼Œè®© effect åœ¨ä¾èµ–å˜åŒ–æ—¶é‡æ–°æ‰§è¡Œã€‚

âœ… è§£æ³• 2ï¼ˆè¿›é˜¶ï¼‰

ä½¿ç”¨ useRef ä¿å­˜å¯å˜å€¼ï¼Œé¿å…é¢‘ç¹è§¦å‘ effectï¼ŒåŒæ—¶ä¿è¯è¯»å–çš„æ˜¯æœ€æ–°å€¼ã€‚

âœ… è§£æ³• 3ï¼ˆå‡½æ•°å¼æ›´æ–°ï¼‰

ä½¿ç”¨ setState(prev => â€¦) é¿å…ä¾èµ–å¤–éƒ¨æ—§çŠ¶æ€ã€‚

â¸»

â“ é¢è¯•å®˜è¿½é—® 2

ä¸ºä»€ä¹ˆä¸ç”¨â€œéšä¾¿è¡¥ä¾èµ–â€å°±å®Œäº‹ï¼Ÿ

å› ä¸ºå¯èƒ½å¯¼è‡´ effect é¢‘ç¹é‡è·‘ï¼Œç”šè‡³äº§ç”Ÿæ­»å¾ªç¯ï¼Œéœ€è¦ç»“åˆ useMemo / useCallback ç¨³å®šä¾èµ–ã€‚

â¸»

ğŸ§  ä¸€å¥è¯é¢è¯•æ€æ‰‹é”

é—­åŒ…é™·é˜±ä¸æ˜¯ React çš„ bugï¼Œè€Œæ˜¯å‡½æ•°ç»„ä»¶ + JavaScript é—­åŒ…æ¨¡å‹å¸¦æ¥çš„å¿…ç„¶ç»“æœã€‚

â¸»

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç»§ç»­ Q4ï¼š
ğŸ‘‰ useRef å’Œ useState çš„æ ¸å¿ƒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ—¶å€™åªèƒ½ç”¨ useRefï¼Ÿ

useState ç”¨æ¥ç®¡ç†ä¼šå½±å“ UI æ¸²æŸ“çš„æ•°æ®ï¼Œè€Œ useRef ç”¨æ¥ä¿å­˜ä¸ä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“çš„å¯å˜å€¼ã€‚

useState æ›´æ–°åä¼šè§¦å‘ç»„ä»¶é‡æ–° renderï¼Œè€Œ useRef çš„ .current æ”¹å˜ä¸ä¼šå¼•èµ· renderã€‚

å› æ­¤ï¼ŒuseRef æ›´é€‚åˆä¿å­˜ä¸€äº›â€œè·¨ render æŒä¹…åŒ–ã€ä½†ä¸éœ€è¦é©±åŠ¨ UI æ›´æ–°â€çš„æ•°æ®ã€‚

â¸»

ğŸ§  å†è¡¥ä¸€å¥ï¼ˆåŠ åˆ†ï¼‰

useRef æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåœ¨æ•´ä¸ªç»„ä»¶ç”Ÿå‘½å‘¨æœŸå†…ä¿æŒç¨³å®šå¼•ç”¨çš„å®¹å™¨ã€‚

â¸»

â“ é¢è¯•å®˜è¿½é—® 1

ä»€ä¹ˆæ—¶å€™â€œåªèƒ½â€ç”¨ useRefï¼Œä¸èƒ½ç”¨ useStateï¼Ÿ

å½“æ•°æ®å˜åŒ–é¢‘ç¹ã€ä½†ä¸å¸Œæœ›å¼•èµ·é‡æ–°æ¸²æŸ“æ—¶ï¼Œåªèƒ½ç”¨ useRefã€‚

ä¾‹å¦‚ï¼š
	â€¢	setInterval / setTimeout çš„ timerId
	â€¢	ä¸Šä¸€æ¬¡çš„ props / state
	â€¢	DOM å®ä¾‹
	â€¢	WebSocket / Observer å®ä¾‹
	â€¢	æ˜¯å¦å·²è¯·æ±‚è¿‡ï¼ˆflagï¼‰

â¸»

â“ é¢è¯•å®˜è¿½é—® 2

é‚£ useRef ä¸ºä»€ä¹ˆä¸ä¼šè§¦å‘ renderï¼Ÿ

å› ä¸º React ä¸ä¼šè¿½è¸ª .current çš„å˜åŒ–ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ™®é€šçš„å¯å˜å¯¹è±¡ï¼Œä¸å‚ä¸ React çš„æ›´æ–°è°ƒåº¦ã€‚

â¸»

ğŸ§  ä¸€å¥è¯ç»ˆææ€»ç»“ï¼ˆé¢è¯•å®˜æœ€çˆ±ï¼‰

useState è´Ÿè´£â€œé©±åŠ¨è§†å›¾â€ï¼ŒuseRef è´Ÿè´£â€œä¿å­˜çŠ¶æ€â€ï¼Œä¸¤è€…èŒè´£å®Œå…¨ä¸åŒã€‚

â¸»

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€é¢˜å¯ä»¥ç›´æ¥ä¸Š Q5ï¼ˆReact 18 å¿…é—®ï¼‰ï¼š
ğŸ‘‰ ä»€ä¹ˆæ˜¯å¹¶å‘æ¸²æŸ“ï¼ˆConcurrent Renderingï¼‰ï¼Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ
å¹¶å‘æ¸²æŸ“ï¼ˆConcurrent Renderingï¼‰æ˜¯ React 18 å¼•å…¥çš„ä¸€ç§æ–°çš„æ¸²æŸ“æœºåˆ¶ï¼Œå®ƒå…è®¸ React åœ¨ render é˜¶æ®µå°†æ›´æ–°æ‹†åˆ†æˆå¤šä¸ªå¯ä¸­æ–­çš„å°ä»»åŠ¡ï¼Œå¹¶é€šè¿‡è°ƒåº¦å™¨æ ¹æ®ä¼˜å…ˆçº§æ‰§è¡Œã€‚

å½“æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„ç”¨æˆ·äº¤äº’ï¼ˆå¦‚è¾“å…¥ã€ç‚¹å‡»ï¼‰å‘ç”Ÿæ—¶ï¼ŒReact å¯ä»¥æš‚åœå½“å‰ä½ä¼˜å…ˆçº§æ¸²æŸ“ï¼Œå…ˆå¤„ç†äº¤äº’ï¼Œé¿å… UI é˜»å¡ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶å‘æ¸²æŸ“åªå‘ç”Ÿåœ¨ render é˜¶æ®µï¼Œcommit é˜¶æ®µä»ç„¶æ˜¯åŒæ­¥ã€ä¸å¯ä¸­æ–­çš„ï¼Œä»¥ä¿è¯ DOM æ›´æ–°çš„ä¸€è‡´æ€§ã€‚

â¸»

ğŸ¯ è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼ˆè¿™æ ·æ€»ç»“ï¼‰

è§£å†³äº†é•¿æ—¶é—´ render å¯¼è‡´ä¸»çº¿ç¨‹è¢«å ç”¨ã€ç”¨æˆ·äº¤äº’æ— å“åº”çš„é—®é¢˜ï¼Œæé«˜äº†å¤æ‚åº”ç”¨çš„å¯äº¤äº’æ€§å’Œæµç•…åº¦ã€‚

â¸»

â“ é¢è¯•å®˜å¸¸è§è¿½é—®ï¼ˆæå‰ç»™ä½ å…œåº•ï¼‰

è¿½é—® 1ï¼šå¹¶å‘æ¸²æŸ“æ˜¯ä¸æ˜¯å¤šçº¿ç¨‹ï¼Ÿ

ä¸æ˜¯ï¼Œä»ç„¶æ˜¯å•çº¿ç¨‹ï¼Œåªæ˜¯ æ—¶é—´åˆ‡ç‰‡ + å¯ä¸­æ–­è°ƒåº¦ã€‚

è¿½é—® 2ï¼šå“ªäº› API ç”¨åˆ°äº†å¹¶å‘èƒ½åŠ›ï¼Ÿ

useTransitionã€startTransitionã€useDeferredValue

è¿½é—® 3ï¼šå¹¶å‘æ¸²æŸ“é»˜è®¤å¼€å¯å—ï¼Ÿ

React 18 åœ¨ createRoot ä¸‹å¼€å¯ï¼Œä½†åªæœ‰ä½¿ç”¨å¹¶å‘ç›¸å…³ API çš„æ›´æ–°æ‰ä¼šè¢«æ ‡è®°ä¸ºä½ä¼˜å…ˆçº§ã€‚

â¸»

ğŸ§  ä¸€å¥è¯é¢è¯•æ€æ‰‹é”

å¹¶å‘æ¸²æŸ“çš„æœ¬è´¨ä¸æ˜¯â€œæ›´å¿«â€ï¼Œè€Œæ˜¯â€œæ›´å¯æ§ã€æ›´æµç•…â€ã€‚

ğŸ¤ Q6

useTransition å’Œ useDeferredValue çš„åŒºåˆ«ï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿ

â¸»

âœ… æ ‡å‡†å›ç­”

useTransition ç”¨æ¥æ ‡è®°ä¸€æ®µæ›´æ–°ä¸ºâ€œä½ä¼˜å…ˆçº§â€ä»»åŠ¡ï¼Œå…è®¸ React åœ¨å¤„ç†é«˜ä¼˜å…ˆçº§äº¤äº’ï¼ˆå¦‚è¾“å…¥ã€ç‚¹å‡»ï¼‰æ—¶ï¼Œå¯ä»¥ä¸­æ–­æˆ–å»¶è¿Ÿä½ä¼˜å…ˆçº§æ›´æ–°ï¼Œä»è€Œä¿è¯ UI æµç•…ã€‚

useDeferredValue ç”¨æ¥å»¶è¿ŸæŸä¸ªå€¼çš„æ›´æ–°ï¼Œè®©ä¾èµ–å®ƒçš„ç»„ä»¶æ›´æ–°ä¹Ÿå˜ä¸ºä½ä¼˜å…ˆçº§ï¼Œä»è€Œé¿å…å¤§åˆ—è¡¨æˆ–å¤æ‚è®¡ç®—é˜»å¡ä¸»çº¿ç¨‹ã€‚

â¸»

ğŸ§  æ ¸å¿ƒåŒºåˆ«ï¼ˆé¢è¯•å®˜å¿…è¿½é—®ç‚¹ï¼‰
ç‰¹æ€§
useTransition
useDeferredValue
ä½œç”¨å¯¹è±¡
æ•´æ®µ state æ›´æ–°é€»è¾‘
å•ä¸ªå€¼
ä¼˜å…ˆçº§
ä½ä¼˜å…ˆçº§ä»»åŠ¡
å»¶è¿Ÿæ›´æ–°å€¼ï¼ˆä½ä¼˜å…ˆçº§ï¼‰
ç”¨æ³•
startTransition(() => setState(...))
const deferred = useDeferredValue(value)
åœºæ™¯
è¡¨å•è¾“å…¥ + å¤§é‡æ¸²æŸ“
å¤§å‹åˆ—è¡¨æœç´¢ / å¤æ‚è®¡ç®—ä¾èµ–å€¼

â“ é¢è¯•å®˜åŠ åˆ†è¿½é—®
	1.	useTransition ä¼šé˜»å¡ UI å—ï¼Ÿ

ä¸ä¼šï¼Œé«˜ä¼˜å…ˆçº§äº¤äº’ä¼˜å…ˆæ‰§è¡Œï¼Œä½ä¼˜å…ˆçº§æ›´æ–°å¯ä¸­æ–­æˆ–å»¶è¿Ÿã€‚

	2.	useDeferredValue ä¼šä¸¢æ•°æ®å—ï¼Ÿ

ä¸ä¼šï¼Œåªæ˜¯æ¸²æŸ“å»¶è¿Ÿï¼Œæœ€ç»ˆå€¼ä¼šåŒæ­¥åˆ°è§†å›¾ã€‚

	3.	ä¸¤è€…å¯ä»¥ç»„åˆå—ï¼Ÿ

å¯ä»¥ï¼ŒuseTransition åŒ…è£¹é€»è¾‘ï¼ŒuseDeferredValue å»¶è¿ŸæŸäº›å€¼ï¼Œè®©å¤§å‹ UI æ›´æ–°æ›´åŠ å¹³æ»‘ã€‚

â¸»

ğŸ§  ä¸€å¥è¯æ€»ç»“æ€æ‰‹é”

useTransition å»¶è¿Ÿâ€œåŠ¨ä½œâ€ï¼ŒuseDeferredValue å»¶è¿Ÿâ€œå€¼â€ï¼Œéƒ½æ˜¯å¹¶å‘æ¸²æŸ“åœ¨ UI æµç•…æ€§ä¸Šçš„ä¸¤ç§åº”ç”¨ã€‚

â¸»

ğŸ¤ Q7

ä¸ºä»€ä¹ˆ React çš„ setState æ˜¯å¼‚æ­¥çš„ï¼Ÿä»€ä¹ˆæ—¶å€™åŒæ­¥ï¼Ÿ

React ä¸­ setState åœ¨äº‹ä»¶å¤„ç†å‡½æ•°æˆ–ç”Ÿå‘½å‘¨æœŸä¸­æ˜¯å¼‚æ­¥çš„ï¼Œè¿™æ˜¯ä¸ºäº†æ‰¹é‡åˆå¹¶æ›´æ–°ï¼Œæé«˜æ€§èƒ½ã€‚

å¼‚æ­¥çš„æœ¬è´¨æ˜¯ React ä¼šæŠŠå¤šæ¬¡æ›´æ–°åˆå¹¶ï¼Œç„¶åç»Ÿä¸€æ¸²æŸ“ä¸€æ¬¡ DOMï¼Œè€Œä¸æ˜¯æ¯æ¬¡ setState éƒ½è§¦å‘ renderã€‚

åŒæ­¥æƒ…å†µï¼š
	â€¢	åŸç”Ÿäº‹ä»¶ / setTimeout / promise.then ä¸­è°ƒç”¨ setStateï¼ŒReact ä¸ä¼šè‡ªåŠ¨æ‰¹å¤„ç†ï¼ˆReact 18 æ”¹è¿›åå¤§éƒ¨åˆ†åœºæ™¯è‡ªåŠ¨æ‰¹å¤„ç†ï¼‰ã€‚

â¸»

â“ é¢è¯•å®˜è¿½é—®
	1.	ä¸ºä»€ä¹ˆè¦æ‰¹å¤„ç†ï¼Ÿ

å‡å°‘ä¸å¿…è¦çš„ DOM æ›´æ–°ï¼Œæé«˜æ¸²æŸ“æ•ˆç‡ã€‚

	2.	setState é‡Œçš„å›è°ƒå‡½æ•°ä¸ºä»€ä¹ˆå¸¸ç”¨ï¼Ÿ

å¯ä»¥æ‹¿åˆ°æœ€æ–° stateï¼Œé¿å…é—­åŒ…æ—§å€¼é—®é¢˜ã€‚

â¸»

ğŸ¤ Q8

ä¸ºä»€ä¹ˆè¦ç”¨ keyï¼Ÿä¸ºä»€ä¹ˆä¸èƒ½ç”¨ indexï¼Ÿ

â¸»

âœ… æ ‡å‡†ç­”æ¡ˆ

key ç”¨äºæ ‡è¯†åˆ—è¡¨ä¸­æ¯ä¸ªç»„ä»¶æˆ– DOM å…ƒç´ çš„å”¯ä¸€èº«ä»½ï¼Œå¸®åŠ© React æ­£ç¡®å¤ç”¨å’Œæ›´æ–°èŠ‚ç‚¹ã€‚

ä¸èƒ½ç”¨ index çš„åŸå› ï¼š
	â€¢	å½“åˆ—è¡¨é¡ºåºå˜åŒ–æ—¶ï¼Œindex ä¼šå¤ç”¨é”™è¯¯çš„ç»„ä»¶ï¼Œå¯¼è‡´çŠ¶æ€é”™ä¹±
	â€¢	ä¼šç ´å React diff çš„æœ€ä¼˜ç®—æ³•

â¸»

â“ é¢è¯•å®˜è¿½é—®
	1.	ä»€ä¹ˆæ—¶å€™å¯ä»¥å®‰å…¨ç”¨ indexï¼Ÿ

åˆ—è¡¨é™æ€ã€ä¸ä¼šæ·»åŠ /åˆ é™¤/æ’åºæ—¶ã€‚

	2.	key æœ€ä½³å®è·µï¼Ÿ

ä½¿ç”¨å”¯ä¸€ä¸”ç¨³å®šçš„ idï¼Œå°½é‡é¿å…ç”Ÿæˆéšæœºæ•°ã€‚

â¸»

ğŸ¤ Q9

React.memoã€useMemoã€useCallback åŒºåˆ«ï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿ


â¸»

âœ… æ ‡å‡†ç­”æ¡ˆ
API
ä½œç”¨
è§¦å‘æ¡ä»¶
React.memo
ç»„ä»¶çº§ä¼˜åŒ–ï¼Œé˜»æ­¢å­ç»„ä»¶é‡å¤ render
props æœªå˜åŒ–
useMemo
ç¼“å­˜å‡½æ•°è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—
ä¾èµ–å˜åŒ–
useCallback
ç¼“å­˜å‡½æ•°å®ä¾‹ï¼Œé¿å…å­ç»„ä»¶å› å‡½æ•°å¼•ç”¨å˜åŒ–é‡æ–° render
ä¾èµ–å˜åŒ–

æ€»ç»“ï¼šReact.memo æ§åˆ¶ç»„ä»¶ï¼ŒuseMemo/useCallback æ§åˆ¶æ¸²æŸ“è¿‡ç¨‹ä¸­çš„å€¼å’Œå‡½æ•°ã€‚

â¸»

â“ é¢è¯•å®˜è¿½é—®
	1.	useCallback ä¸€å®šæœ‰æ€§èƒ½æå‡å—ï¼Ÿ

ä¸ä¸€å®šï¼Œæ»¥ç”¨ä¼šå¢åŠ å†…å­˜å¼€é”€ã€‚

	2.	useMemo ä¸€å®šè¦ç”¨å—ï¼Ÿ

ä»…åœ¨è®¡ç®—é‡å¤§æˆ–ä¾èµ–é¢‘ç¹å˜åŒ–æ—¶ä½¿ç”¨ã€‚

â¸»

ğŸ¤ Q10

React ç”Ÿå‘½å‘¨æœŸ Hooks å¯¹æ¯”ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ

âœ… æ ‡å‡†ç­”æ¡ˆ

ç±»ç»„ä»¶
Hooks å¯¹åº”
componentDidMount
useEffect(() => {}, [])
componentDidUpdate
useEffect(() => {}, [deps])
componentWillUnmount
useEffect(() => { return () => {} }, [])
getDerivedStateFromProps
useEffect + state / useMemo
shouldComponentUpdate
React.memo / useMemo / useCallback

Hooks ç”¨â€œå‡½æ•° + ä¾èµ–æ•°ç»„â€ç»„åˆæ¥æ›¿ä»£ç±»ç»„ä»¶åˆ†æ•£çš„ç”Ÿå‘½å‘¨æœŸï¼Œé€»è¾‘å¤ç”¨æ›´æ–¹ä¾¿ã€‚

â¸»

ğŸ§  ç»ˆææ€æ‰‹é”

React Hooks + å¹¶å‘æ¸²æŸ“ + key + memo + useEffect ä¾èµ–æ§åˆ¶ï¼Œæ˜¯å¤§å‚é¢è¯•å®˜æœ€å…³å¿ƒçš„æ ¸å¿ƒèƒ½åŠ›ç‚¹ã€‚

â¸»
