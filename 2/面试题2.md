ä¸€ã€ä»€ä¹ˆæ˜¯é™æµï¼ˆThrottleï¼‰

åœ¨å•ä½æ—¶é—´å†…ï¼Œå‡½æ•°æœ€å¤šæ‰§è¡Œä¸€æ¬¡

ğŸ“Œ æ ¸å¿ƒç›®çš„ï¼š
	â€¢	é˜²æ­¢é«˜é¢‘äº‹ä»¶ï¼ˆscroll / resize / mousemove / touchmoveï¼‰ç–¯ç‹‚è§¦å‘
	â€¢	æ§åˆ¶æ‰§è¡Œé¢‘ç‡ï¼Œé™ä½æ€§èƒ½æ¶ˆè€—

â¸»

äºŒã€é™æµ vs é˜²æŠ–ï¼ˆé¢è¯•å¿…é—®ï¼‰

å¯¹æ¯”ç‚¹
é˜²æŠ– debounce
é™æµ throttle
è§¦å‘ç­–ç•¥
åœæ­¢è§¦å‘åæ‰§è¡Œ
å›ºå®šæ—¶é—´é—´éš”æ‰§è¡Œ
é«˜é¢‘æ“ä½œ
âŒ ä¸é€‚åˆè¿ç»­åé¦ˆ
âœ… é€‚åˆæŒç»­åé¦ˆ
åœºæ™¯
è¾“å…¥æ¡†æœç´¢
æ»šåŠ¨ç›‘å¬ / æ‹–æ‹½


ğŸ‘‰ ä¸€å¥è¯ç§’æ€é¢è¯•å®˜ï¼š

é˜²æŠ–æ˜¯ã€Œç­‰ä½ åœä¸‹æ¥å†åšã€ï¼Œé™æµæ˜¯ã€Œä½ å†æ€¥æˆ‘ä¹ŸæŒ‰èŠ‚å¥æ¥ã€

â¸»

ä¸‰ã€åŸºç¡€ç‰ˆé™æµï¼ˆæ—¶é—´æˆ³ï¼‰

ç‰¹ç‚¹
	â€¢	é¦–æ¬¡ç«‹å³æ‰§è¡Œ
	â€¢	æœ«å°¾å¯èƒ½ä¸¢å¤±ä¸€æ¬¡

	function throttle(fn, delay) {
  let lastTime = 0
  return function (...args) {
    const now = Date.now()
    if (now - lastTime >= delay) {
      lastTime = now
      fn.apply(this, args)
    }
  }
}

ğŸ“Œ é€‚åˆï¼š
	â€¢	scroll å®æ—¶ä½ç½®è®¡ç®—
	â€¢	é¡µé¢æ»šåŠ¨åŸ‹ç‚¹

âš ï¸ ç¼ºç‚¹ï¼š
	â€¢	æœ€åä¸€æ¬¡è§¦å‘å¯èƒ½æ‰§è¡Œä¸åˆ°ï¼ˆé¢è¯•ä¼šè¿½é—®ï¼‰

â¸»

å››ã€å®šæ—¶å™¨ç‰ˆé™æµï¼ˆsetTimeoutï¼‰

ç‰¹ç‚¹
	â€¢	é¦–æ¬¡ä¸ç«‹å³æ‰§è¡Œ
	â€¢	ä¸€å®šä¼šæ‰§è¡Œæœ€åä¸€æ¬¡

	function throttle(fn, delay) {
  let timer = null
  return function (...args) {
    if (!timer) {
      timer = setTimeout(() => {
        timer = null
        fn.apply(this, args)
      }, delay)
    }
  }
}
ğŸ“Œ é€‚åˆï¼š
	â€¢	resize åé‡æ–°è®¡ç®—å¸ƒå±€
	â€¢	å¸Œæœ›ç»“æœâ€œå®Œæ•´â€çš„åœºæ™¯

â¸»

äº”ã€é«˜é˜¶ç‰ˆé™æµï¼ˆé¦–å°¾å¯æ§ï½œé¢è¯•åŠ åˆ†ï¼‰

æ”¯æŒé…ç½®ï¼š
	â€¢	leadingï¼šæ˜¯å¦é¦–æ¬¡ç«‹å³æ‰§è¡Œ
	â€¢	trailingï¼šæ˜¯å¦ç»“æŸåè¡¥ä¸€æ¬¡

	function throttle(fn, delay, options = {}) {
  let lastTime = 0
  let timer = null
  const { leading = true, trailing = true } = options

  return function (...args) {
    const now = Date.now()

    if (!lastTime && !leading) {
      lastTime = now
    }

    const remaining = delay - (now - lastTime)

    if (remaining <= 0) {
      if (timer) {
        clearTimeout(timer)
        timer = null
      }
      lastTime = now
      fn.apply(this, args)
    } else if (!timer && trailing) {
      timer = setTimeout(() => {
        lastTime = leading ? Date.now() : 0
        timer = null
        fn.apply(this, args)
      }, remaining)
    }
  }
}

ğŸ¯ è¿™æ˜¯ lodash.throttle çš„æ ¸å¿ƒæ€æƒ³

â¸»

å…­ã€requestAnimationFrame é™æµï¼ˆæ€§èƒ½ç‹è€…ï¼‰

é€‚åˆåŠ¨ç”» / æ»šåŠ¨è”åŠ¨

function throttleRAF(fn) {
  let locked = false
  return function (...args) {
    if (locked) return
    locked = true
    requestAnimationFrame(() => {
      fn.apply(this, args)
      locked = false
    })
  }
}
ğŸš€ ä¼˜ç‚¹ï¼š
	â€¢	è‡ªåŠ¨å¯¹é½æµè§ˆå™¨åˆ·æ–°ç‡ï¼ˆâ‰ˆ16.6msï¼‰
	â€¢	æ¯” setTimeout æ›´æµç•…

ğŸ“Œ ç”¨é€”ï¼š
	â€¢	æ»šåŠ¨å¸é¡¶
	â€¢	è§†å·®æ»šåŠ¨
	â€¢	æ‹–æ‹½åŠ¨ç”»

â¸»

ä¸ƒã€é¢è¯•å®˜ã€Œè¿½æ€çº§ã€è¿½é—® & æ ‡å‡†å›ç­”

Q1ï¼šä¸ºä»€ä¹ˆ scroll å¿…é¡»é™æµï¼Ÿ

âœ… ç­”ï¼š

scroll æ¯ä¸€åƒç´ éƒ½ä¼šè§¦å‘äº‹ä»¶ï¼Œä¸é™æµä¼šå¯¼è‡´é¢‘ç¹ JS æ‰§è¡Œã€å›æµé‡ç»˜ã€é¡µé¢å¡é¡¿

â¸»

Q2ï¼šé™æµä¸ºä»€ä¹ˆæ¯”é˜²æŠ–æ›´é€‚åˆæ»šåŠ¨ï¼Ÿ

âœ… ç­”ï¼š

æ»šåŠ¨è¿‡ç¨‹éœ€è¦æŒç»­åé¦ˆï¼Œé˜²æŠ–åªä¼šåœ¨åœæ­¢æ—¶è§¦å‘ï¼Œä½“éªŒä¸è¿ç»­

â¸»

Q3ï¼šå¦‚ä½•ä¿è¯æœ€åä¸€æ¬¡ä¸€å®šæ‰§è¡Œï¼Ÿ

âœ… ç­”ï¼š

ä½¿ç”¨ trailing + å®šæ—¶å™¨è¡¥å¿ï¼Œæˆ–è€…æ—¶é—´æˆ³ + setTimeout ç»„åˆ

â¸»

Q4ï¼šä¸ºä»€ä¹ˆ rAF æ¯” setTimeout æ›´é€‚åˆåŠ¨ç”»ï¼Ÿ

âœ… ç­”ï¼š

rAF ä¸æµè§ˆå™¨æ¸²æŸ“èŠ‚å¥åŒæ­¥ï¼Œé¿å…æ‰å¸§å’Œæ— æ•ˆæ¸²æŸ“

å…«ã€ä¸€å¥è¯ã€Œç»ˆææ€»ç»“ã€ï¼ˆèƒŒä¸‹æ¥ï¼‰

é™æµ = æ§åˆ¶æ‰§è¡Œé¢‘ç‡ï¼Œä¸æ§åˆ¶è§¦å‘æ¬¡æ•°
æœ¬è´¨ï¼šæ—¶é—´çª—å£ + çŠ¶æ€é”

ğŸ§¨ åœºæ™¯é¢˜ï¼ˆçœŸå®ä¸šåŠ¡ï¼‰

é¡µé¢æ˜¯ä¸€ä¸ªé•¿åˆ—è¡¨å•†å“é¡µï¼š

	â€¢	å•†å“åˆ—è¡¨æ˜¯å¼‚æ­¥åˆ†é¡µåŠ è½½ï¼ˆæ»šåŠ¨åˆ°åº•éƒ¨ç»§ç»­åŠ è½½ï¼‰
	â€¢	æ¯ä¸ªå•†å“å¡ç‰‡éƒ½æœ‰ï¼š
	â€¢	mousemove æ˜¾ç¤ºæµ®å±‚
	â€¢	click è¿›å…¥è¯¦æƒ…
	â€¢	é¡µé¢è¿˜éœ€è¦ï¼š
	â€¢	æ»šåŠ¨æ—¶æ˜¾ç¤º / éšè—å¸é¡¶å¯¼èˆª
	â€¢	å®æ—¶ä¸ŠæŠ¥ç”¨æˆ·æ»šåŠ¨ä½ç½®ï¼ˆåŸ‹ç‚¹ï¼‰

âš ï¸ å•†å“èŠ‚ç‚¹æ˜¯åŠ¨æ€ç”Ÿæˆçš„

â¸»

â“é—®é¢˜ 1ï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰

Qï¼šä¸ºä»€ä¹ˆè¿™é‡Œå¿…é¡»ç”¨äº‹ä»¶å§”æ‰˜ï¼Ÿä¸ç”¨ä¼šæ€æ ·ï¼Ÿ

âœ… æ ‡å‡†æ»¡åˆ†å›ç­”

å› ä¸ºå•†å“èŠ‚ç‚¹æ˜¯åŠ¨æ€åˆ›å»ºçš„ï¼Œå¦‚æœé€ä¸ªç»‘å®šäº‹ä»¶ï¼š
1ï¸âƒ£ æ–°èŠ‚ç‚¹éœ€è¦é‡å¤ç»‘å®š
2ï¸âƒ£ èŠ‚ç‚¹é”€æ¯åå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼
3ï¸âƒ£ å¤§é‡ç›‘å¬å™¨å¢åŠ å†…å­˜å’Œäº‹ä»¶æ´¾å‘æˆæœ¬

ğŸ‘‰ ä½¿ç”¨äº‹ä»¶å§”æ‰˜ï¼š
	â€¢	åªåœ¨çˆ¶å®¹å™¨ç»‘å®šä¸€æ¬¡
	â€¢	åˆ©ç”¨äº‹ä»¶å†’æ³¡
	â€¢	è‡ªåŠ¨æ”¯æŒåŠ¨æ€èŠ‚ç‚¹

	list.addEventListener('click', (e) => {
  const item = e.target.closest('.item')
  if (!item) return
  // å¤„ç†ç‚¹å‡»
})

ğŸ’£ è¿½æ€è¡¥åˆ€ï¼š

ä¸ºä»€ä¹ˆé˜»æ­¢å†’æ³¡ä¸ä¼šå½±å“äº‹ä»¶å§”æ‰˜ï¼Ÿ
âœ… å› ä¸ºå§”æ‰˜ç›‘å¬åœ¨å†’æ³¡é˜¶æ®µï¼Œé˜»æ­¢çš„æ˜¯åç»­å†’æ³¡ï¼Œä¸å½±å“æ•è·é˜¶æ®µçš„äº‹ä»¶ä¼ é€’ã€‚

â¸»

â“é—®é¢˜ 2ï¼ˆmousemove ä¸ºä»€ä¹ˆå¿…é¡»é˜²æŠ–ï¼‰

Qï¼šä¸ºä»€ä¹ˆ mousemove ä¸èƒ½ç›´æ¥å¤„ç†ï¼Ÿä¸ºä»€ä¹ˆä¸ç”¨é™æµï¼Ÿ

âœ… æ»¡åˆ†å›ç­”

mousemove è§¦å‘é¢‘ç‡æé«˜ï¼Œå¦‚æœæ¯æ¬¡éƒ½æ‰§è¡Œé€»è¾‘ï¼š
	â€¢	ä¼šé¢‘ç¹è®¡ç®— DOM ä½ç½®
	â€¢	è§¦å‘é‡æ’ / é‡ç»˜
	â€¢	é¡µé¢ä¸¥é‡æ‰å¸§

ğŸ‘‰ è¿™é‡Œä½¿ç”¨ é˜²æŠ–ï¼š
	â€¢	åªæœ‰ç”¨æˆ·åœä¸‹æ¥æ‰å±•ç¤ºæµ®å±‚
	â€¢	é¿å…æ— æ„ä¹‰ä¸­é—´æ€è®¡ç®—

	const showTip = debounce((item) => {
  // è®¡ç®—å¹¶æ˜¾ç¤ºæµ®å±‚
}, 200)

ğŸ¯ è¿½é—®åæ€ï¼š

å¦‚æœå¸Œæœ›ç§»åŠ¨ä¸­ä¹Ÿèƒ½çœ‹åˆ°è·Ÿéšæ•ˆæœï¼Ÿ
âœ… æ”¹ç”¨ rAF é™æµï¼Œè€Œä¸æ˜¯é˜²æŠ–ã€‚

â¸»

â“é—®é¢˜ 3ï¼ˆscroll ä¸ºä»€ä¹ˆç”¨é™æµè€Œä¸æ˜¯é˜²æŠ–ï¼‰

Qï¼šæ»šåŠ¨ç›‘å¬ä¸ºä»€ä¹ˆå¿…é¡»é™æµï¼Ÿ

âœ… æ»¡åˆ†å›ç­”

æ»šåŠ¨è¿‡ç¨‹ä¸­éœ€è¦æŒç»­åé¦ˆï¼š
	â€¢	æ˜¯å¦æ˜¾ç¤ºå¸é¡¶
	â€¢	æ˜¯å¦è§¦åº•åŠ è½½
	â€¢	æ˜¯å¦ä¸ŠæŠ¥åŸ‹ç‚¹

é˜²æŠ–åªä¼šåœ¨æ»šåŠ¨åœæ­¢åè§¦å‘ï¼Œä¸ç¬¦åˆéœ€æ±‚ã€‚

const onScroll = throttle(() => {
  checkSticky()
  checkLoadMore()
  reportScroll()
}, 200)

ğŸ’¥ è¡¥åˆ€è¿½é—®ï¼š

ä¸ºä»€ä¹ˆåŸ‹ç‚¹ä¸èƒ½ç”¨é˜²æŠ–ï¼Ÿ
âœ… å› ä¸ºé˜²æŠ–ä¼šä¸¢å¤±è¿‡ç¨‹æ•°æ®ï¼Œæ— æ³•åæ˜ ç”¨æˆ·çœŸå®æ»šåŠ¨è¡Œä¸ºã€‚

â¸»

â“é—®é¢˜ 4ï¼ˆäº‹ä»¶å§”æ‰˜ + é™æµç»„åˆï¼‰

Qï¼šscroll + click åŒæ—¶å­˜åœ¨ï¼Œä¼šä¸ä¼šäº’ç›¸å½±å“ï¼Ÿ

âœ… æ»¡åˆ†å›ç­”

ä¸ä¼šã€‚
	â€¢	scroll æ˜¯ window çº§äº‹ä»¶
	â€¢	click é€šè¿‡äº‹ä»¶å§”æ‰˜ç»‘å®šåœ¨åˆ—è¡¨å®¹å™¨
	â€¢	å„è‡ªç‹¬ç«‹çš„äº‹ä»¶ç³»ç»Ÿï¼Œä¸å…±äº«è°ƒç”¨æ ˆ

ä½†éœ€è¦æ³¨æ„ï¼š
	â€¢	scroll å›è°ƒå¿…é¡»é™æµ
	â€¢	click å†…éƒ¨é¿å…å¤æ‚åŒæ­¥é€»è¾‘

â¸»

â“é—®é¢˜ 5ï¼ˆæ‰‹å†™ç»„åˆå®ç°ï¼‰

Qï¼šè¯·ä½ è®¾è®¡ä¸€ä¸ªé«˜æ€§èƒ½æ–¹æ¡ˆ

âœ… æ»¡åˆ†è®¾è®¡ï¼ˆé¢è¯•ç‹è€…ï¼‰

// scroll é™æµ
window.addEventListener(
  'scroll',
  throttle(handleScroll, 200)
)

// åˆ—è¡¨äº‹ä»¶å§”æ‰˜
list.addEventListener('click', handleClick)
list.addEventListener(
  'mousemove',
  throttleRAF(handleHover)
)

// hover é˜²æŠ–
const showTip = debounce(renderTooltip, 200)

ğŸ¯ ä¸€å¥è¯æ€»ç»“æ–¹æ¡ˆï¼š

æ»šåŠ¨ â†’ é™æµ
é«˜é¢‘ç§»åŠ¨ â†’ rAF é™æµ
éå®æ—¶åé¦ˆ â†’ é˜²æŠ–
åŠ¨æ€èŠ‚ç‚¹ â†’ äº‹ä»¶å§”æ‰˜

â¸»

ğŸ§  ç»ˆæè¿½æ€é¢˜ï¼ˆ99% äººç¿»è½¦ï¼‰

Qï¼šå¦‚æœ throttle + äº‹ä»¶å§”æ‰˜ä¸€èµ·ç”¨ï¼Œthis æŒ‡å‘è°ï¼Ÿ

âœ… æ ‡å‡†ç­”æ¡ˆ

this å–å†³äºï¼š
	â€¢	throttle å†…éƒ¨æ˜¯å¦ fn.apply(this)
	â€¢	äº‹ä»¶è§¦å‘æ—¶ this é»˜è®¤æŒ‡å‘ç»‘å®šå…ƒç´ 

ğŸ‘‰ æ­£ç¡®å†™æ³•ï¼š

fn.apply(this, args)


â¸»

ğŸ† é¢è¯•ç»ˆæä¸€å¥è¯

äº‹ä»¶å§”æ‰˜è§£å†³â€œè°ç›‘å¬â€
é˜²æŠ– / é™æµè§£å†³â€œç›‘å¬å¤šä¹…æ‰§è¡Œä¸€æ¬¡â€



