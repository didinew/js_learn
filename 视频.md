你的视频站项目，为什么选择 Vue3？

我选择 Vue3，主要因为它组件化能力强，比如播放器、播放控制、弹幕、评论区都可以独立拆分；
同时 Composition API 可以把播放控制、弹幕逻辑、埋点等复用逻辑抽离成 composable，统一管理，提高可维护性；
另外 Vue3 的 响应式系统 可以高效管理 UI 状态，比如播放进度、全屏状态，保证界面和数据同步。

播放器拖动进度条时，可能会很卡，你会怎么优化？

播放器进度拖动时，我会做两件事：
	1.	UI 流畅：拖动过程中只更新前端显示，不频繁触发 seek 操作，保证动画不卡顿；
	2.	数据防抖：播放进度只在拖动结束（mouseup / touchend）或定时（例如 5~10s）上报后端，避免频繁请求或写入数据库。


弹幕很多时，页面会卡，你会怎么优化？

	1.	分区加载：根据播放时间，将弹幕分区管理，只渲染当前播放区的弹幕；
	2.	避开 Vue 响应式：弹幕列表不走响应式系统，避免频繁 diff 导致组件重渲染；
	3.	虚拟列表 + 懒加载：只渲染可视区域内的弹幕，超出部分按需加载；
	4.	Canvas / transform 动画：使用 canvas 或 transform 做弹幕动画，减少 DOM 重排和重绘压力；
	5.	rAF 渲染：高频动画通过 requestAnimationFrame 更新，保证动画流畅。


视频切换时，你是如何避免重复请求数据的？

在视频切换时，我会先判断 videoId是否已经存在；
	•	如果缓存里已有该视频的信息，就直接使用缓存，避免重复请求；
	•	如果没有，就发请求获取数据，并缓存到本地（比如 Pinia 或 Map），保证下次访问同视频可以复用。
这样既减少了网络请求，也提升了切换视频的流畅度。

你的视频页路由切换需要注意哪些问题？

	1.	播放器状态保持：切换视频时，尽量不要销毁播放器组件（可用 keep-alive），只切换 source，保证视频流畅播放，避免重新加载影响体验。
	2.	暂停逻辑：如果用户离开视频页或切换到别的路由，要及时暂停视频，避免后台播放浪费资源。
	3.	数据刷新：切换视频时，需要判断缓存，避免重复请求视频信息、评论、弹幕等。
	4.	UI 状态重置：例如全屏、进度条、音量等状态，需要在切换视频时根据需要重置或保留，保证用户体验一致。

你的视频站首屏加载比较慢，你是怎么优化的？

1.	视频层面：使用 preload="metadata"，只预加载视频元信息，避免首屏直接拉整段视频；
	2.	传输层面：采用 m3u8 + ts 的流式方案，减少单次加载体积，提高首帧速度；
	3.	网络层面：视频资源走 CDN，提高命中率，减少跨地域延迟；
	4.	视觉层面：使用 poster 作为占位，保证首屏快速可见；
	5.	列表渲染：推荐列表和评论区使用虚拟列表 + 懒加载，减少首屏 DOM 压力。


播放过程中，你是怎么记录用户观看进度的？
如果用户刷新页面，下次还能从上次位置继续播吗？

播放进度我会通过 timeupdate 做节流处理，避免高频上报；
在合适的时间间隔内，把当前播放时间 持久化到 localStorage（或 IndexedDB）；
页面刷新或用户再次进入时，先读取本地记录，再调用 seek 定位到上次播放位置，实现断点续播。

为什么你不把弹幕 / 播放进度这些高频数据放到 Pinia 全局管理？

高并发、高频更新的数据（比如弹幕、播放进度）我不会放进 Pinia，
因为这类数据进入全局响应式后，会触发大量组件依赖更新，
容易造成不必要的重渲染甚至渲染错乱，对性能不友好。

这类数据更适合：
	•	放在 非响应式的缓冲区（buffer） 中，按时间或区域分区处理；
	•	只把需要展示的可视区域数据交给 UI 层（配合虚拟列表）；
	•	渲染阶段通过 防抖 / 节流 控制更新频率；
	•	动画和弹幕使用 transform 或 canvas，
	•	最终由 requestAnimationFrame 在一帧内统一渲染 UI。


如果让你重构整个视频站播放器模块，
你会如何做架构拆分和职责划分？

如果重构播放器模块，我会做分层设计，保证职责单一、可维护性高：
	1.	播放器核心层（Player Core）
	•	只负责和 <video> 或播放器实例交互
	•	管理播放、暂停、seek、音量等底层能力
	•	不关心 UI 和业务逻辑
	2.	逻辑层（Composable / Hooks）
	•	抽离播放控制、进度管理、弹幕调度等逻辑
	•	保证逻辑可复用、可测试
	•	屏蔽具体 UI 实现
	3.	UI / 业务展示层
	•	只负责状态展示和用户交互
	•	不直接操作播放器实例
	•	通过 props / events 与逻辑层通信


如果播放过程中突然网络变差甚至断网，
你的视频站是如何保证用户体验的？

播放过程中如果网络变差或中断，我会从稳定性和用户体验两个方面处理：
	1.	自动重试与重连：检测到加载失败或卡顿时，先尝试自动重连，避免立刻打断用户；
	2.	清晰度降级：在网络较差时，自动切换到更低分辨率的视频流，保证播放连续性；
	3.	用户提示兜底：如果多次重试仍失败，会明确提示用户网络异常，并提供刷新或手动重试入口，避免无反馈造成困惑。


我主要负责一个 Vue3 的视频站项目，核心模块是播放器、弹幕和评论区。
在架构上我通过 组件拆分 + Composition API 抽离播放和弹幕逻辑，保证职责单一、方便复用。
对于播放进度和弹幕这种高频数据，我会刻意避开 Vue 响应式，通过缓冲区、节流和 requestAnimationFrame 控制更新，避免性能问题。
在性能优化上，首屏使用 preload="metadata"、流式视频、CDN 和虚拟列表，保证加载和滚动体验。
整体目标是让播放器稳定、流畅，同时代码结构清晰、可维护。